set -euo pipefail
declare SLEEP_DURATION=${SLEEP_DURATION:-"1m"}
cd /opt
mkdir -p src/github.com/blockpress
cd src/github.com/blockpress
if [[ ! -e blockpress.me ]]; then
	echo "[ $(basename "$0") ] Doing initial git clone.."
	git clone https://github.com/blockpress/blockpress.me.git
fi
if [[ ! -e /var/www ]]; then
	echo "[ $(basename "$0") ] Creating symlink.."
	ln -s /opt/src/github.com/blockpress/blockpress.me /var/www
fi
cd blockpress.me
while true; do
	echo "[ $(basename "$0") ] Pulling down any changes.."
	git pull
	echo "[ $(basename "$0") ] Sleeping ${SLEEP_DURATION}.."
	sleep ${SLEEP_DURATION}
done
